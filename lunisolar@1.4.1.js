!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).lunisolar=t()}(this,(function(){"use strict";var e={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",q:"quarter",y:"year",lh:"lunarhour",ld:"lunarday",lM:"lunarmonth",ly:"lunaryear",ch:"char8hour",cd:"char8day",cM:"char8month",cy:"char8year"},t=new Set(["lunarhour","lunarday","lunarmonth","lunaryear"]),n="Invalid Date",r=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,a=/\[([^\]]+)]|cZ|t|T|lYn|lMn|lDn|lHn|lY|lM|lL|lD|lH|cYs|cYb|cY|cMs|cMb|cM|cDs|cDb|cD|cHs|cHb|cH|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,i=[[9],[5,9,7],[0,2,4],[1],[4,1,9],[2,6,4],[3,5],[5,3,1],[6,8,4],[7],[4,7,3],[8,0]],o=[2018,12,7],u=[2022,3,12],c={name:"zh",leap:"閏",lunarYearUnit:"年",lunarHourUnit:"時",bigMonth:"大",smallMonth:"小",weekdays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],weekdaysShort:["週日","週一","週二","週三","週四","週五","週六"],weekdaysMin:["日","一","二","三","四","五","六"],months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),lunarMonths:"正月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),lunarMonthsAlias:"正月_二月_三月_四月_五月_六月_七月_八月_九月_十月_冬月_腊月".split("_"),lunarDays:"初一_初二_初三_初四_初五_初六_初七_初八_初九_初十_十一_十二_十三_十四_十五_十六_十七_十八_十九_二十_廿一_廿二_廿三_廿四_廿五_廿六_廿七_廿八_廿九_三十".split("_"),numerals:"〇一二三四五六七八九十".split(""),constellationName:"白羊座_金牛座_雙子座_巨蟹座_狮子座_處女座_天秤座_天蝎座_射手座_摩羯座_水瓶座_雙魚座".split("_"),solarTerm:"小寒_大寒_立春_雨水_驚蟄_春分_清明_穀雨_立夏_小滿_芒種_夏至_小暑_大暑_立秋_處暑_白露_秋分_寒露_霜降_立冬_小雪_大雪_冬至".split("_"),seasonName:"春夏秋冬".split(""),stems:["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],branchs:["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],stemBranchSeparator:"",chineseZodiac:["鼠","牛","虎","兔","龍","蛇","馬","羊","猴","雞","狗","豬"],fiveElements:["木","火","土","金","水"],eightTrigram:"坤震坎兌艮離巽乾".split(""),moonPhase:{"朔":"朔","望":"望","弦":"弦","晦":"晦"},directions:["","北","西南","東","東南","中","西北","西","東北","南"],formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah點mm分",LLLL:"YYYY年M月D日ddddAh點mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},meridiem:function(e,t){var n=100*e+t;return n<600?"凌晨":n<900?"早上":n<1100?"上午":n<1300?"中午":n<1800?"下午":"晚上"}},l={changeAgeTerm:2,locales:{zh:c},lang:"zh"},s=1901,f=2100,h=[1874,3749,43818,1611,2715,39590,1386,2905,19370,1874,52645,2853,2635,47691,685,1387,17845,3497,65170,3730,3365,44333,2646,694,39637,1748,3753,20298,3730,50854,1323,2647,47446,2906,1748,30561,1865,64275,2707,1323,54555,2733,1386,40357,2980,2889,19787,2709,60077,1334,2733,47818,1458,3493,32418,3402,66965,2711,1366,50549,2773,1746,34645,3749,1610,26191,2715,60122,1386,2921,43954,2898,2853,35627,2635,68267,685,1389,54697,3497,3474,36501,3365,85581,2646,694,49909,1749,3753,44882,3730,3366,25902,2647,68310,858,1749,43881,1865,1683,35483,1323,2651,19118,1386,60885,2980,2889,44371,2709,1325,34141,2741,76714,1490,3493,56970,3402,3221,35486,1366,2741,19162,1746,51045,1829,1611,42583,3243,1370,25966,2921,94034,2898,2853,56587,2635,1195,41659,1453,2922,19882,3474,61093,3365,2645,47693,1206,1461,30418,3785,69522,3730,3366,54550,2647,1366,37733,1877,1865,26443,1683,60075,1323,2651,43706,1386,2917,35754,2890,69013,2709,1325,50541,2741,1450,34261,3493,3402,28237,3222,60622,1366,2741,47826,1746,3749,34602,1675,67223,1195,1371,54614,2922,1874,35733,2885,2699,19023,1195],g=[219,208,129,216,204,125,213,202,122,210,130,218,206,126,214,203,123,211,201,220,208,128,216,205,124,213,202,123,210,130,217,206,126,214,204,124,211,131,219,208,127,215,205,125,213,202,122,210,129,217,206,127,214,203,124,212,131,218,208,128,215,205,125,213,202,121,209,130,217,206,127,215,203,123,211,131,218,207,128,216,205,125,213,202,220,209,129,217,206,127,215,204,123,210,131,219,207,128,216,205,124,212,201,122,209,129,218,207,126,214,203,123,210,131,219,208,128,216,205,125,212,201,122,210,129,217,206,126,213,203,123,211,131,219,208,128,215,204,124,212,201,122,210,130,217,206,126,214,202,123,211,201,219,208,128,215,204,124,212,202,121,209,129,217,205,126,214,203,123,211,131,219,207,127,215,205,124,212,202,122,209,129,217,206,126,214,203,124,210,130,218,207,127,215,205,125,212,201,121,209],_=[4,19,3,18,4,19,4,19,4,20,4,20,6,22,6,22,6,22,7,22,6,21,6,21],p=[0x6aaaa6aa9a5a,0xaaaaaabaaa6a,0xaaabbabbafaa,99670716471979,0xaaaaaaaaaa6a,0x6aaaa6aa9a56,0xaaaaaaaa9a5a,0xaaabaabaaeaa,95203950484138,99671807007318,0x6aaaaaaa9a5a,99671806990934,0xaaabaabaaa6a,93829556755114,99670716471894,93829556689578,95203950484054,0x6aa6a6aa9a56,93829288253866,95203950484053,0x6aa6a6a65a56,93829288252842,93824993285482,93829556755029,93824992236906,93829556689493,0x6aa6a6aa9a5a,93824992232810,93829288254037,99601996995158,0x6aa6a6a69a5a,93824925123930,93829288253781,99671790213718,23456180946266,93824993285461,95203946289749,93824993285397,93824992236821,23439001077082,93824992232725,23439000814938,93824925123861,23439000798550,93824925123845,23437910279510,23456180946181,5845724235094,23439000814853,5777004758358,23439000798469,1378954052950,23437910279425,1378954052949,93824992236885,5845724235009,4564518229,4296017237,5777004758273,23438984021253,1378954052865,23437910279429,1048661,1378954052864,85,4564518144,21,4296082688],v=[0,1,2,3,0,4,2,3,0,4,2,3,5,6,7,8,9,10,7,8,11,10,12,8,11,0,1,13,14,0,1,13,14,0,4,13,14,0,4,13,14,0,4,15,16,17,6,18,19,20,6,18,19,11,0,21,19,14,0,22,23,14,0,22,23,14,0,24,23,14,0,24,25,14,26,27,28,29,30,27,28,16,20,31,32,19,33,34,35,36,14,34,37,23,14,34,38,23,14,34,38,23,14,34,38,28,14,39,40,28,29,41,42,28,16,43,44,32,36,45,46,35,36,47,46,38,23,47,46,38,23,47,46,38,28,47,46,38,28,47,48,40,28,49,50,42,28,51,52,44,35,53,52,44,54,53,55,46,54,56,55,46,38,56,55,46,38,57,55,48,38,57,58,48,42,57,58,59,42,57,60,61,44,62,63,52,44,64,63,55,46,64,65,55,46,66,67,55,46,38],d=function(t){return t?(t=t.trim(),e[t]||(t||"").toLowerCase().replace(/s$/,"")):""},m=function(e){if(void 0===e)return new Date;if(null===e)return new Date(NaN);if("object"==typeof e&&!(e instanceof Date)&&void 0!==e.toDate){var t=e.toDate();if(t instanceof Date)return t}if(e instanceof Date)return e;if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(r);if(n){var a=n[2]-1||0,i=(n[7]||"0").substring(0,3);return new Date(n[1],a,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)}}return new Date(e)},y=function(e){var t=g[e-s];return m("".concat(e,"/").concat(Math.floor(t/100),"/").concat(t%100))},b=function(e){var t=h[e-s];return[t>>13,1===(t>>12&1)]},O=function(e,t){var n;!function(e,t){var n=l.locales[null!=t?t:l.lang];if("string"==typeof e.year){for(var r="",a=0;a<e.year.length;a++){var i=-1;r+=(i="零"===e.year[a]||"〇"===e.year[a]?0:n.numerals.indexOf(e.year[a]))>=0?i:""}"二〇二〇"===e.year&&console.log(r),e.year=Number(r)}if("string"==typeof e.month){var o=e.month;o[0]===n.leap&&(e.isLeapMonth=!0,o=e.month.slice(1));var u=n.lunarMonths.indexOf(o);-1===u&&(u=n.lunarMonthsAlias.indexOf(o)),e.month=e.isLeapMonth?u+100+1:u+1}"string"==typeof e.day&&(e.day=n.lunarDays.indexOf(e.day)+1),"string"==typeof e.hour&&(e.hour=n.branchs.indexOf(e.hour))}(e,t);var r=new Date,a=e.year?Number(e.year):r.getFullYear(),i=Number(e.month),o=Number(e.day),u=e.hour?Number(e.hour):0,c=null!==(n=e.isLeapMonth)&&void 0!==n&&n;if(i>100&&(i-=100,c=!0),a<s||a>f)throw new Error("Invalid lunar year: out of range");if(i<1)throw new Error("Invalid lunar month");var g=y(a),_=b(a),p=_[0],v=_[1];if(c&&p!==i)throw new Error("Invalid lunar leap month: no this leap month");for(var d=h[a-s],m=c?v:d>>i-1&1,O=0,M=0;M<i;M++){if(O+=d>>M&1?30:29,M===i-1&&!c)break;M===p-1&&(O+=v?30:29)}return O-=(m?30:29)-o+1,new Date(g.valueOf()+24*O*60*60*1e3+2*u*60*60*1e3)},M=function(e,t,n){var r=n.getDate(),a=e.getMonth(),i=t/2>>0,u=i<a||0===a&&11===i||r>e.getDate()&&!(r-1===e.getDate()&&e.getHours()>=23)?-1:0;return((12*(e.getFullYear()-o[0])+e.getMonth()-o[1]+1)%60+u+60)%60};var S={stem:[10,"stems"],branch:[12,"branchs"],trigram8:[8,"eightTrigram"],element5:[5,"fiveElements"]},w=function(e,t,n,r){if("number"==typeof e)e%=S[t][0];else if("string"==typeof e){var a=r.locales[n][S[t][1]].indexOf(e);if(-1===a)throw new Error("Invalid ".concat(t," value"));e=a}return e};var D=function(e,t){var n;e=(n=[m(e),m(t)])[0];var r=12*((t=n[1]).getFullYear()-e.getFullYear())+(t.getMonth()-e.getMonth()),a=new Date(e).setMonth(e.getMonth()+r),i=a.valueOf()>t.valueOf(),o=new Date(e).setMonth(e.getMonth()+r+(i?-1:1));return r+(t.valueOf()-a.valueOf())/(i?a-o:o-a)||0},Y=function(e,t,n){if(e>t)return-Y(t,e);for(var r=[e.lunar,t.lunar],a=r[0],i=r[1],o=[a.year,i.year],u=o[0],c=o[1],l=[a.month,i.month],s=l[0],f=l[1],h=u,g=0;h<=c;){var _=[1,12],p=_[0],v=_[1];h===u&&(p=s),h===c&&(v=f),g+=j(h,p,v),h++}if(!n)return g-1;if(g>0)g+=P(e,!0)+P(t,!1)-2;else{var d=a.isBigMonth?30:29;g=(t.valueOf()-e.valueOf())/(864e5*d)}return g},j=function(e,t,n){var r=!1;(t=t||1)>100&&(t-=100,r=!0),(n=n||12)>100&&(n-=100,r=!0);var a=h[e-s]>>13;return t<=a&&a<=n&&(r=!0),n-t+1+(r?1:0)},P=function(e,t){void 0===t&&(t=!1);var n=e.lunar.isBigMonth?30:29,r=e.lunar.day;return t?1-r/n:r/n},T=function(e,t){void 0===t&&(t=!1);var n=e.lunar.leapMonth,r=n>0?13:12,a=!1,i=e.lunar.month;i>100&&(i-=100,a=!0),n>0&&(i>n||i===n&&a)&&i++;var o=P(e,t);return t?1-(i-o)/r:(i+o-1)/r};var L=function(e,t){if(t._date.toString()===n)return n;var r,i,o,u,c=e||"YYYY-MM-DDTHH:mm:ssZ",s=t._date.getFullYear(),f=t._date.getMonth()+1,h=t._date.getDate(),g=t._date.getDay(),_=t._date.getHours(),p=t._date.getMinutes(),v=t._date.getSeconds(),d=(r=-t.utcOffset(),i=Math.abs(r),o=Math.floor(i/60),u=i%60,"".concat(r<=0?"+":"-").concat(String(o).padStart(2,"0"),":").concat(String(u).padStart(2,"0"))),m=t.lunar,y=t.char8,b=l.locales[t._config.lang],O=b.weekdays,M=b.months,S=function(e,t,n,r){return e&&e[t]||(n?n[t].slice(0,r):"")},w=_%12||12,D=b.meridiem||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r},Y={YY:String(s).slice(-2),YYYY:String(s),M:String(f),MM:String(f).padStart(2,"0"),MMM:S(b.monthsShort,f-1,M,3),MMMM:S(M,f-1),D:String(h),DD:String(h).padStart(2,"0"),d:String(g),dd:S(b.weekdaysMin,g,O,2),ddd:S(b.weekdaysShort,g,O,3),dddd:O[g],H:String(_),HH:String(_).padStart(2,"0"),h:String(w),hh:String(w).padStart(2,"0"),a:D(_,p,!0),A:D(_,p,!1),m:String(p),mm:String(p).padStart(2,"0"),s:String(v),ss:String(v).padStart(2,"0"),SSS:String(t._date.getMilliseconds()).padStart(3,"0"),Z:d,cZ:b.chineseZodiac[y.year.branch.value],t:t.solarTerm?String(t.solarTerm.value+1):"",T:t.solarTerm?t.solarTerm.toString():"",lY:m.getYearName(),lM:m.getMonthName(),lD:m.getDayName(),lH:m.getHourName(),lL:m.isBigMonth?b.bigMonth:b.smallMonth,lYn:String(m.year),lMn:String(m.month),lDn:String(m.day),lHn:String(m.hour+1),cY:y.year.toString(),cYs:y.year.stem.toString(),cYb:y.year.branch.toString(),cM:y.month.toString(),cMs:y.month.stem.toString(),cMb:y.month.branch.toString(),cD:y.day.toString(),cDs:y.day.stem.toString(),cDb:y.day.branch.toString(),cH:y.hour.toString(),cHs:y.hour.stem.toString(),cHb:y.hour.branch.toString()};return c=c.replace(a,(function(e,t){return t||Y[e]||d.replace(":","")}))};function N(e,t){return Math.floor((t.valueOf()-e.valueOf())/864e5)}var H=function(){function e(e,t){var n;this._config={lang:l.lang},t&&(this._config=Object.assign({},this._config,t));var r=m(e);this._date=r;var a=r.getFullYear(),i=r.getMonth(),o=r.getHours();if(a<s||a>f||a===s&&i<1||a===s&&1===i&&r.getDate()<19)throw new Error("Invalid lunar year: out of range");var u=N(y(a),r);r&&23===o&&(u+=1),u<0&&(u=N(y(a-=1),r)),this._y=a;var c=b(a),g=c[0],_=c[1];this.leapMonth=g,this.leapMonthIsBig=_,n=function(e,t,n){var r=h[e-s],a=n||b(e),i=a[0],o=a[1],u=1;t+=1;for(var c=!1;t>29;){if(t-=r>>u-1&1?30:29,u===i){var l=o?30:29;if(!(t>l)){c=!0;break}t-=l}if(0===t){t=30;break}u++}return[c?100+u:u,t]}(a,u,[g,_]),this._m=n[0],this._d=n[1],this._h=(o+1)%24>>1}return e.fromLunar=function(t,n){return new e(O(t,null==n?void 0:n.lang),n)},Object.defineProperty(e.prototype,"isLeapMonth",{get:function(){return this._m>100},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBigMonth",{get:function(){var e=h[this._y-s];return this.isLeapMonth?1==(e>>12&1):1==(e>>this._m-1&1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLastDayOfMonth",{get:function(){return!(!this.isBigMonth||30!==this.day)||!this.isBigMonth&&29===this.day},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"year",{get:function(){return this._y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"month",{get:function(){return this._m},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"day",{get:function(){return this._d},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hour",{get:function(){return this._h},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lunarNewYearDay",{get:function(){return y(this._y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastDayOfYear",{get:function(){var e=y(this.year+1);return new Date(e.valueOf()-864e5)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"phaseOfTheMoon",{get:function(){return function(e,t){var n=e.day;return 1===n?t.moonPhase.朔:[7,8,22,23].includes(n)?t.moonPhase.弦:15===n?t.moonPhase.望:e.isLastDayOfMonth?t.moonPhase.晦:""}(this,l.locales[this._config.lang])},enumerable:!1,configurable:!0}),e.prototype.toDate=function(){return new Date(this._date.valueOf())},e.prototype.getYearName=function(){for(var e="",t=this._y,n=l.locales[this._config.lang].numerals;t;){e=n[t%10]+e,t=Math.floor(t/10)}return e},e.prototype.getMonthName=function(){var e=l.locales[this._config.lang].lunarMonths,t=l.locales[this._config.lang].leap;return(this.isLeapMonth?t:"")+e[this._m%100-1]},e.prototype.getDayName=function(){return l.locales[this._config.lang].lunarDays[this._d-1]},e.prototype.getHourName=function(){return l.locales[this._config.lang].branchs[this._h]},e.prototype.toString=function(){var e=l.locales[this._config.lang];return"".concat(this.getYearName()).concat(e.lunarYearUnit).concat(this.getMonthName()).concat(this.getDayName()).concat(this.getHourName()).concat(e.lunarHourUnit)},e.prototype.valueOf=function(){return this._date.valueOf()},e.getLunarNewYearDay=function(e){return y(e)},e}();var x=function(){function e(t,n){if(this._value=-1,this._config={lang:l.lang},n&&(this._config=Object.assign({},this._config,n)),t instanceof e)return t;if("number"==typeof t)this._value=t%24;else if("string"==typeof t){var r=l.locales[this._config.lang].solarTerm.indexOf(t);if(-1===r)throw new Error("Invalid term value");this._value=r}}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.getNames=function(e){return e=e||l.lang,function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}([],l.locales[e].solarTerm,!0)},e.getYearTermDayList=function(e){for(var t=[],n=p[v[e-s]].toString(2).padStart(48,"0");t.length<24;){var r=parseInt(n.slice(n.length-2),2),a=_[t.length];t.push(r+a),n=n.slice(0,n.length-2)}return t},e.getMonthTerms=function(e,t){var n=p[v[e-s]].toString(2).padStart(48,"0"),r=4*(t-1),a=parseInt(n.slice(n.length-r-4,n.length-r),2);return[(3&a)+_[2*(t-1)],(a>>2&3)+_[2*(t-1)+1]]},e.findDate=function(t,n,r){var a=r&&r.lang?r.lang:l.lang;return n instanceof e&&(n=n.value),[t,((n="string"==typeof n?l.locales[a].solarTerm.indexOf(n):n%24)>>1)+1,e.getYearTermDayList(t)[n]]},e.findNode=function(t,n){var r,a={lang:l.lang,returnValue:!1,nodeFlag:0},i=n?Object.assign({},a,n):a,o=i.returnValue,u=i.nodeFlag;if(u>2)throw new Error("Invalid nodeFlag");var c,s={lang:i.lang||l.lang},f=t.getFullYear(),h=t.getMonth(),g=t.getDate(),_=t.getHours(),p=(2*h+24)%24,v=e.getMonthTerms(f,h+1),d=v[0],y=v[1],b=!1,O=!1;g<d&&!(g===d-1&&_>=23)?b=!0:g<y&&!(g===y-1&&_>=23)&&(O=!0,1===u&&(b=!0));var M=!1;b?(h-1<0?(f--,h=11):h--,p=(2*h+24)%24,d=(r=e.getMonthTerms(f,h+1))[0],y=r[1],u>0&&(M=!0)):(1===u||2===u&&!O)&&(M=!0),c=M?y:d,p=M?(p+1)%24:p;var S=m("".concat(f,"-").concat(h+1,"-").concat(c));return o?[p,S]:[new e(p,s),S]},e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(){return String(l.locales[this._config.lang].solarTerm[this.value])},e}(),A=function(){function e(t,n){if(this._value=-1,this._config={lang:l.lang},t instanceof e)return t;n&&(this._config=Object.assign({},this._config,n)),this._value=w(t,"element5",this._config.lang,l)}return e.create=function(t,n){if(t instanceof e)return t;var r=(null==n?void 0:n.lang)||l.lang;t=w(t,"element5",r,l);var a="".concat(t,":").concat(r);if(e.instances.has(a))return e.instances.get(a);var i=new e(t,n);return e.instances.set(a,i),i},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return-1===this._value?"Invalid five-element value":l.locales[this._config.lang].fiveElements[this._value]},e.prototype.valueOf=function(){return this._value},e.instances=new Map,e}(),B=function(){function e(e,t){this._value=-1,this._config={lang:l.lang},t&&(this._config=Object.assign({},this._config,t)),this._value=e%8}return e.create=function(t,n){var r=(null==n?void 0:n.lang)||l.lang;t=w(t,"trigram8",r,l);var a="".concat(t,":").concat(r);if(e.instances.has(a))return e.instances.get(a);var i=new e(t,n);return e.instances.set(a,i),i},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return l.locales[this._config.lang].eightTrigram[this._value]},e.prototype.valueOf=function(){return this._value},e.instances=new Map,e}(),I=function(){function e(t,n){if(this._value=-1,this._hiddenStems=[],this._config={lang:l.lang},t instanceof e)return t;n&&(this._config=Object.assign({},this._config,n)),this._value=w(t,"branch",this._config.lang,l)}return e.create=function(t,n){if(t instanceof e)return t;var r=(null==n?void 0:n.lang)||l.lang;t=w(t,"branch",r,l);var a="".concat(t,":").concat(r);if(e.instances.has(a))return e.instances.get(a);var i=new e(t,n);return e.instances.set(a,i),i},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hiddenStems",{get:function(){if(this._hiddenStems.length)return this._hiddenStems;var e=i[this._value];return this._hiddenStems=e.map((function(e){return new F(e)})),this._hiddenStems},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"e5",{get:function(){if(this._e5)return this._e5;var e=Math.floor((this._value+10)/3)%4;return(this._value+10)%3==2?this._e5=A.create(2,this._config):this._e5=A.create(e<2?e:e+1,this._config),this._e5},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"triad",{get:function(){return[e.create((this._value+4)%12,this._config),e.create((this._value+8)%12,this._config)]},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return l.locales[this._config.lang].branchs[this._value]},e.prototype.valueOf=function(){return this._value},e.instances=new Map,e}(),F=function(){function e(t,n){if(this._value=-1,this._branchs=[],this._config={lang:l.lang},t instanceof e)return t;n&&(this._config=Object.assign({},this._config,n)),this._value=w(t,"stem",this._config.lang,l)}return e.create=function(t,n){if(t instanceof e)return t;var r=(null==n?void 0:n.lang)||l.lang;t=w(t,"stem",r,l);var a="".concat(t,":").concat(r);if(e.instances.has(a))return e.instances.get(a);var i=new e(t,n);return e.instances.set(a,i),i},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"branchs",{get:function(){var e=this;if(this._branchs.length)return this._branchs;var t=l.locales[this._config.lang].branchs.filter((function(t,n){return n%2==e._value%2}));return this._branchs=t.map((function(t){return I.create(t,e._config)})),this._branchs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"e5",{get:function(){return this._e5||(this._e5=A.create(Math.floor(this._value/2),this._config)),this._e5},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trigram8",{get:function(){return B.create([7,0,4,3,2,5,1,5,7,0][this._value],this._config)},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return l.locales[this._config.lang].stems[this._value]},e.prototype.valueOf=function(){return this._value},e.instances=new Map,e}(),E=function(){function e(e,t,n){if(this._value=-1,this._config={lang:l.lang},n&&(this._config=Object.assign({},this._config,n)),"number"==typeof t||"string"==typeof t||t instanceof I){this._stem=F.create(e,this._config),this._branch=I.create(t,this._config);var r=this._stem.valueOf(),a=this._branch.valueOf();this._value=function(e,t){if((e+t)%2!=0)throw new Error("Invalid SB value");return e%10+(6-(t>>1)+(e>>1))%6*10}(r,a)}else{if("number"!=typeof e)throw new Error("Invalid SB value");this._value=e%60;r=this._value%10,a=this._value%12;this._stem=F.create(r,this._config),this._branch=I.create(a,this._config)}}return Object.defineProperty(e.prototype,"stem",{get:function(){return this._stem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"branch",{get:function(){return this._branch},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var e,t=l.locales[this._config.lang];return"".concat(this._stem).concat(null!==(e=null==t?void 0:t.stemBranchSeparator)&&void 0!==e?e:"").concat(this._branch)},e.prototype.valueOf=function(){return this._value},e}(),k=function(){function e(t,n){if(this._value=-1,this._config={changeAgeTerm:l.changeAgeTerm,lang:l.lang},n&&(this._config=Object.assign({},this._config,n)),t instanceof Date){var r=e.computeSBYear(t,this._config),a=e.computeSBMonth(t,this._config),i=e.computeSBDay(t,this._config);t=[r,a,i,e.computeSBHour(t,i,this._config)]}if(!Array.isArray(t))throw new Error("Invalid Char8");this._list=t,this._value=this._computeValue(t)}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"year",{get:function(){return this._list[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"month",{get:function(){return this._list[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"day",{get:function(){return this._list[2]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hour",{get:function(){return this._list[3]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"me",{get:function(){return this._list[2].stem},enumerable:!1,configurable:!0}),e.prototype._computeValue=function(e){void 0===e&&(e=this._list);for(var t=0,n=0;n<4;n++)t+=e[n].valueOf()*Math.pow(10,2*(3-n));return t},e.computeSBYear=function(e,t){var n=t&&void 0!==t.changeAgeTerm?t.changeAgeTerm:l.changeAgeTerm,r="number"!=typeof e?e.getFullYear():e;if(null!=n&&"number"!=typeof e){var a=(n%=24)<0;n=n>=0?n:24+n;var i=e.getFullYear();a&&i--;var o=i+1,u=x.findDate(i,n),c=x.findDate(o,n),s=m("".concat(u[0],"-").concat(u[1],"-").concat(u[2]-1," 23:00:00")),f=m("".concat(c[0],"-").concat(c[1],"-").concat(c[2]-1," 23:00:00"));e.valueOf()<s.valueOf()?r--:e.valueOf()>=f.valueOf()&&r++}else if(null===n&&"number"!=typeof e){var h=H.getLunarNewYearDay(r);e.valueOf()<h.valueOf()-36e5&&r--}return new E((r-4)%10,(r-4)%12,t)},e.computeSBMonth=function(e,t){var n=t&&void 0!==t.lang?t.lang:l.lang,r={lang:n,returnValue:!0,nodeFlag:((t&&void 0!==t.changeAgeTerm?t.changeAgeTerm:l.changeAgeTerm)+24)%2},a=x.findNode(e,r),i=a[0],o=a[1],u=M(e,i,o);return new E(u,void 0,{lang:n})},e.computeSBDay=function(e,t){var n=m("".concat(u[0],"-").concat(u[1],"-").concat(u[2]-1," 23:00:00")),r=Math.floor((e.valueOf()-n.valueOf())/864e5)%60;return r<0&&(r+=60),new E(r,void 0,t)},e.computeSBHour=function(t,n,r){n||(n=e.computeSBDay(t));var a,i,o=t.getHours(),u=n.stem,c=(o+1>>1)%12,l=(a=u.value,void 0===(i=c)&&(i=0),(a%5*2+i)%10);return new E(l,c,r)},e.prototype.toString=function(){return"".concat(this.year," ").concat(this.month," ").concat(this.day," ").concat(this.hour)},e.prototype.valueOf=function(){return this._value},e}(),C=function(){function n(e,t){this._cache=new Map,this._date=m(e),this._config=Object.assign({},l,t)}return Object.defineProperty(n.prototype,"lunisolar",{get:function(){return q},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lunar",{get:function(){return this._lunar||(this._lunar=new H(this._date,{lang:this._config.lang})),this._lunar},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"char8",{get:function(){if(this._char8)return this._char8;var e={lang:this._config.lang,changeAgeTerm:this._config.changeAgeTerm};return this._char8=new k(this._date,e),this._char8},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"solarTerm",{get:function(){if(void 0!==this._solarTerm)return this._solarTerm;var e=this._date.getFullYear();if(e<s||e>f)throw new Error("".concat(e," is not a lunar year"));var t=this._date.getMonth()+1,n=this._date.getDate(),r=x.getMonthTerms(e,t),a=r[0],i=r[1],o={lang:this._config.lang};return n===a?new x(2*(t-1),o):n===i?new x(2*(t-1)+1,o):null},enumerable:!1,configurable:!0}),n.prototype.recentSolarTerm=function(e){var t="recent_solar_term:".concat(e),n=this.cache(t);if(n)return n;var r=x.findNode(this._date,{lang:this._config.lang,nodeFlag:e,returnValue:!1});return this.cache(t,n),r},n.prototype.getMonthBuilder=function(e){void 0===e&&(e=0);var t="month_builder:".concat(e),n=this.cache(t);if(n)return n;var r={lang:this.getConfig("lang")},a=this.recentSolarTerm(e),i=a[0],o=a[1],u=M(this.toDate(),i.value,o),c=new E(u,void 0,r);return this.cache(t,[c,i,o]),[c,i,o]},n.prototype.getSeasonIndex=function(){var e=this.recentSolarTerm(0)[0].value;return 2<=e&&e<8?0:8<=e&&e<14?1:14<=e&&e<20?2:3},n.prototype.getSeason=function(e){void 0===e&&(e=!1);var t=this.getSeasonIndex(),n=this.getLocale();return e&&n.seasonShortName?n.seasonShortName[t]:n.seasonName[t]},n.prototype.getLocale=function(e){return l.locales[null!=e?e:this._config.lang]},n.prototype.L=function(e){return function(e,t){for(var n=t.split("."),r=e,a=t,i=function(e){return("string"==typeof e||"number"==typeof e||"function"==typeof e)&&(a=e,!0)};n.length>=0&&!i(r)&&0!==n.length;){var o=n.shift();if(void 0===o)return"";if(Array.isArray(r)){var u=Number(o);if(isNaN(u)||u>=r.length)return"";r=r[u],a=r}else{if(!r.hasOwnProperty(o))return n[n.length-1]||o;r=r[o]}}return a}(this.getLocale(),e)},n.prototype.getConfig=function(e){return void 0===e?this._config:(this._config[e],this._config[e])},n.prototype.toDate=function(){return new Date(this._date.valueOf())},n.prototype.clone=function(){return new n(this._date,this._config)},n.prototype.cache=function(e,t){if(void 0===t)return this._cache.has(e)?this._cache.get(e):void 0;this._cache.set(e,t)},n.prototype.unix=function(){return Math.floor(this.valueOf()/1e3)},n.prototype.valueOf=function(){return this._date.valueOf()},n.prototype.utcOffset=function(){return 15*-Math.round(this._date.getTimezoneOffset()/15)},n.prototype.toISOString=function(){return this._date.toISOString()},n.prototype.toString=function(){return this._date.toUTCString()+" (".concat(this.lunar,")")},n.prototype.format=function(e){return L(e,this)},n.prototype.diff=function(r,a,i){return void 0===i&&(i=!1),a=a?d(a):"millisecond",t.has(a)?function(t,n,r,a){var i=[t.lunar,n.lunar],o=i[1],u=[i[0].year,o.year],c=u[0],l=u[1],s=n.valueOf()-t.valueOf();if((r=d(r))===e.ly){var f=l-c;return a?f-1+T(t,!0)+T(n,!1):f}return r===e.lM?Y(t,n,a):(r===e.ld?s/=864e5:r===e.lh&&(s/=72e5),a?s:Math.ceil(s))}(this,r instanceof n?r:new n(r,this._config),a,i):function(t,n,r,a){var i;t=(i=[m(t),m(n)])[0];var o=(n=i[1]).valueOf()-t.valueOf();r=r?d(r):"millisecond";var u=o;return e.s===r?u=o/1e3:e.m===r?u=o/6e4:e.h===r?u=o/36e5:e.d===r?u=o/864e5:e.w===r?u=o/6048e5:e.M===r?u=D(t,n):e.y===r?u=D(t,n)/12:e.q===r&&(u=D(t,n)/3),a?u:parseInt(String(u))}(this._date,r,a,i)},n.prototype.add=function(t,r){var a=function(t,n,r){var a=(t=m(t)).getFullYear(),i=t.getMonth()+1,o=n;if((r=r?d(r):"millisecond")===e.d||r===e.ld)o=24*n*60*60*1e3;else if(r===e.h)o=60*n*60*1e3;else if(r===e.m)o=60*n*1e3;else if(r===e.s)o=1e3*n;else{if(r===e.M)return new Date(t.setMonth(i-1+n));if(r===e.y)return new Date(t.setFullYear(a+n))}return new Date(t.valueOf()+o)}(this.toDate(),t,r);return new n(a,this.getConfig())},n}(),Z=[5,7,11,13,-1,-2,17,19,23,1],z=[4,6,0,7],V=[1,1,8,8,8,3,3,3,4,4,4,9,9,9,2,2,2,7,7,7,6,6,6,1];function U(e){if("number"==typeof e)return e;var t=e.constructor.name,n=e.value;if("Stem"===t)e=Z[n];else if("Branch"===t)e=2*n;else{if("Trigram8"!==t)throw new Error("Invalid direction24 value");var r=z.indexOf(n);if(-1===r)throw new Error("Invalid direction24 value");e=3*(2*r+1)}return e}var $=function(){function e(e,t){this._config={lang:l.lang};var n=U(e);this._value=n;var r=function(e){void 0===e&&(e="zh");var t={lang:e};return[I.create(0,t),F.create(9,t),I.create(1,t),B.create(4,t),I.create(2,t),F.create(0,t),I.create(3,t),F.create(1,t),I.create(4,t),B.create(6,t),I.create(5,t),F.create(2,t),I.create(6,t),F.create(3,t),I.create(7,t),B.create(0,t),I.create(8,t),F.create(6,t),I.create(9,t),F.create(7,t),I.create(10,t),B.create(7,t),I.create(11,t),F.create(8,t)]}((null==t?void 0:t.lang)||l.lang);this._sign=-1===n?F.create(4,t):-1===n?F.create(5,t):r[n%24]}return e.create=function(t,n){var r=U(t),a=(null==n?void 0:n.lang)||"zh",i="".concat(r,":").concat(a);if(e.instances.has(i))return e.instances.get(i);var o=new e(r,n);return e.instances.set(i,o),o},e.createFromAngle=function(t,n){var r=Math.round(t%360/15);return e.create(r,n)},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sign",{get:function(){return this._sign},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"signName",{get:function(){return this._sign.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._sign.constructor.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this._value>0?15*this._value:NaN},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"direction",{get:function(){return l.locales[this._config.lang].directions[this.directionIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"directionIndex",{get:function(){return this._value<0?5:V[this._value]},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this._sign.toString()},e.prototype.valueOf=function(){return this._value},e.instances=new Map,e}();function q(e,t){return e instanceof C&&(e=e.toDate()),new C(e,t)}return q.Lunar=H,q.SolarTerm=x,q.Char8=k,q.SB=E,q.Stem=F,q.Branch=I,q.Element5=A,q.Lunisolar=C,q.Trigram8=B,q.Direction24=$,q.fromLunar=function(e,t){var n=O(e,null==t?void 0:t.lang);return new C(n,t)},q.config=function(e){return e?(Object.assign(l,e),q):q},q.extend=function(e,t){return e.$once||(e(t,C,q),e.$once=!0),q},q.locale=function(e,t){if(void 0===t&&(t=!1),Array.isArray(e)){for(var n=0,r=e;n<r.length;n++){var a=r[n];q.locale(a,t)}return q}return e&&e.name?(t||(l.lang=e.name),l.locales[e.name]=Object.assign({},l.locales[e.name],c,e),q):q},q.getLocale=function(e){return l.locales[e]},q.createLocale=function(e){return e},q._globalConfig=l,Object.defineProperty(q,"_globalConfig",{writable:!1}),q}));